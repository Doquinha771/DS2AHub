<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>DS2A Hub Refatorado ‚Äî Completo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src 'self' data:; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src https://fonts.gstatic.com; script-src 'self' 'unsafe-inline'; frame-src https://www.youtube-nocookie.com https://www.youtube.com; connect-src 'self'; media-src 'self' data:;" />
  <meta name="description" content="Hub central DS2A para aulas, trabalhos, calend√°rio e materiais." />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg-start: #0d1117;
      --bg-end: #010409;
      --glass-bg: rgba(22,27,34,.6);
      --glass-border: rgba(139,148,158,.2);
      --text-primary:#f0f6fc; --text-secondary:#8b949e;
      --accent-1:#58A6FF; --accent-2:#1F6FEB; /* ser√° trocado semanalmente */
      --accent-gradient: linear-gradient(135deg, var(--accent-1), var(--accent-2));
      --success:#3FB950; --warning:#D29922; --danger:#F85149; --holiday:#A371F7;
      --card-shadow: 0 16px 40px rgba(0,0,0,.4);
      --radius-lg:16px; --radius-md:10px; --glass-blur:16px; --t: .35s;
      --cor-geografia:#3FB950; --cor-quimica:#BF39A1; --cor-ingles:#D29922; --cor-fisica:#F85149; --cor-carreira:#58A6FF; --cor-portugues:#A371F7; --cor-historia:#E3B341; --cor-biologia:#2AAA8A; --cor-redes:#F77825; --cor-matematica:#1F6FEB; --cor-sociologia:#DB61A2; --cor-processos:#3FB950; --cor-logica:#A371F7; --cor-edfisica:#F85149; --cor-default:#8b949e;
    }
    html.light-theme {
      --bg-start: #f0f2f5;
      --bg-end: #e4e9f0;
      --glass-bg: rgba(255, 255, 255, .6);
      --glass-border: rgba(0,0,0,.1);
      --text-primary: #1c1e21;
      --text-secondary: #606770;
    }

    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{margin:0;min-height:100vh;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg-end);color:var(--text-primary);display:flex;justify-content:center;padding:18px; padding-bottom: 100px;transition: background .4s, color .4s;}
    .app{width:100%;max-width:980px}
    h1{margin:0;font-size:1.8rem;font-weight:800;background:var(--accent-gradient);-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent}
    .header{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;gap:12px;margin-bottom:10px}
    .tabs{display:none;gap:8px;background:var(--glass-bg);backdrop-filter:blur(var(--glass-blur));-webkit-backdrop-filter:blur(var(--glass-blur));padding:6px;border-radius:999px;border:1px solid var(--glass-border)}
    .tab{padding:8px 16px;border:none;border-radius:999px;background:transparent;color:var(--text-secondary);font-weight:700;cursor:pointer;transition:.2s}
    .tab:hover{background:rgba(255,255,255,.08)}
    html.light-theme .tab:hover{background:rgba(0,0,0,.05)}
    .tab.active{background:var(--accent-2);color:#fff;box-shadow:0 6px 22px rgba(31,111,235,.35)}
    .settings-toggle{width:40px;height:40px;border-radius:50%;border:1px solid var(--glass-border);background:var(--glass-bg);color:var(--text-primary);display:grid;place-items:center;cursor:pointer;transition:.2s}
    .settings-toggle:hover{transform:translateY(-2px);background:var(--accent-1);color:#010409}
    .topbar{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap;color:var(--text-secondary);margin:8px 0 14px}
    .progress-wrap{flex:1;min-width:220px;background:rgba(255,255,255,.06);border:1px solid var(--glass-border);border-radius:999px;overflow:hidden;height:10px;position:relative}
    .progress-bar{height:100%;width:0;background:var(--accent-gradient);transition:width var(--t)}
    .progress-label{font-size:.8rem;margin-left:8px}
    .announcement{background:linear-gradient(135deg, rgba(88,166,255,.12), rgba(31,111,235,.18));border:1px solid var(--glass-border);border-radius:var(--radius-lg);padding:18px;position:relative;overflow:hidden}
    .announcement h2{margin:0 0 6px;font-size:1.05rem}
    .close-x{position:absolute;top:10px;right:10px;width:28px;height:28px;border-radius:50%;border:0;background:rgba(255,255,255,.08);color:var(--text-primary);cursor:pointer}
    .reactions{margin-top:12px;display:flex;gap:8px}
    .react{border:1px solid var(--glass-border);background:rgba(255,255,255,.06);border-radius:999px;padding:6px 10px;cursor:pointer}
    .react.active{background:var(--accent-1);color:#010409;border-color:var(--accent-1)}

    /* --- Anima√ß√µes e Transi√ß√µes --- */
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
    .card, .infobox { animation: fadeInUp 0.6s ease-out both; }
    section[role="tabpanel"] { display: none; }
    section[role="tabpanel"].active { display: block; animation: fadeInUp 0.5s ease-out; }
    .is-past { text-decoration: line-through; opacity: 0.65; }
    .important-note { font-size: .8rem; color: var(--warning); margin-bottom: 5px; border: 1px solid var(--warning); padding: 5px; border-radius: 8px; background: rgba(210, 153, 34, 0.1); }
    #dayEvents.reloading > .event { animation: fadeInUp 0.5s ease-out both; }
    #dayEvents.reloading > .event:nth-child(2) { animation-delay: .08s; }
    #dayEvents.reloading > .event:nth-child(3) { animation-delay: .16s; }
    
    .card{background:var(--glass-bg);border:1px solid var(--glass-border);border-radius:var(--radius-lg);padding:18px;box-shadow:var(--card-shadow);backdrop-filter:blur(var(--glass-blur));-webkit-backdrop-filter:blur(var(--glass-blur))}
    .grid{display:grid;gap:16px}
    .grid.auto{grid-template-columns:repeat(auto-fit,minmax(240px,1fr))}

    .calendar{padding:14px;border-radius:var(--radius-md);background:rgba(255,255,255,.04)}
    .cal-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
    .cal-head button{width:32px;height:32px;border-radius:50%;border:1px solid var(--glass-border);background:rgba(255,255,255,.06);color:var(--text-primary);cursor:pointer}
    .cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
    .cal-day,.cal-date{text-align:center;padding:8px 4px;border-radius:8px;font-size:.85rem}
    .cal-day{color:var(--text-secondary);font-weight:700}
    .cal-date{cursor:pointer;color:var(--text-primary);position:relative}
    .cal-date:hover{background:rgba(255,255,255,.08)}
    html.light-theme .cal-date:hover{background:rgba(0,0,0,.05)}
    .cal-date.today{background:var(--accent-gradient);color:#fff}
    .cal-date.selected{outline:2px solid var(--accent-1)}
    .cal-date.has-events::after{content:'';position:absolute;bottom:4px;left:50%;transform:translateX(-50%);width:5px;height:5px;border-radius:50%;background:var(--accent-1)}
    .cal-date.is-holiday::after{background:var(--holiday)}
    .event{display:flex;gap:8px;align-items:center;background:rgba(255,255,255,.06);padding:10px;border-radius:10px}
    .etype{font-weight:700;font-size:.75rem;padding:4px 8px;border-radius:7px;color:#010409}
    .etype.Prova{background:var(--danger)}
    .etype.Trabalho{background:var(--warning)}
    .etype.Feriado{background:var(--holiday)}

    /* --- Aulas: cards interativos --- */
    .lessons-controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-bottom:8px}
    select, .btn{background:rgba(255,255,255,.08);border:1px solid var(--glass-border);color:var(--text-primary);border-radius:10px;padding:8px 10px}
    .btn{cursor:pointer}
    .summary{display:flex;gap:10px;align-items:center;color:var(--text-secondary);margin:8px 0}
    .badge{font-size:.8rem;font-weight:700;padding:3px 8px;border-radius:8px;background:rgba(255,255,255,.08);align-self:flex-start}
    .lesson-card { background: rgba(255, 255, 255, .06); border: 1px solid var(--glass-border); border-radius: 12px; padding: 12px; display: flex; flex-direction: column; gap: 8px; cursor: pointer; transition: transform .3s ease, box-shadow .3s ease; min-height: 90px; }
    .lesson-card:hover { transform: translateY(-4px); box-shadow: 0 8px 20px rgba(0,0,0,.25); }
    .lesson-header { display: flex; justify-content: space-between; align-items: center; }
    .notes-prompt { color: var(--text-secondary); font-size: .8rem; margin-top: auto; }
    .lesson-notes { display: none; margin-top: 8px; }
    .lesson-card.is-open .lesson-notes { display: block; animation: fadeInUp .45s; cursor: default; }
    .lesson-card.is-open .notes-prompt { display: none; }
    .lesson-notes textarea { width: 100%; background:rgba(0,0,0,.2); border:1px solid var(--glass-border); color:var(--text-primary); border-radius:8px; padding:8px; margin-bottom: 8px; resize: vertical; }
    .save-note { width: 100%; }

    #lessons { max-height: 420px; overflow-y: auto; padding-right: 8px; }
    #lessons::-webkit-scrollbar { width: 6px; }
    #lessons::-webkit-scrollbar-track { background: rgba(255,255,255,.05); border-radius: 10px; }
    #lessons::-webkit-scrollbar-thumb { background: var(--glass-border); border-radius: 10px; }
    #lessons::-webkit-scrollbar-thumb:hover { background: var(--accent-1); }

    /* Trabalhos: timeline */
    .timeline{position:relative;padding-left:12px}
    .t-item{position:relative;margin:8px 0;padding:10px;border:1px solid var(--glass-border);border-radius:10px;background:rgba(255,255,255,.05)}
    .t-item.pending::before{content:'';position:absolute;left:-6px;top:16px;width:10px;height:10px;border-radius:50%;background:var(--warning)}
    .t-item.done::before{content:'';position:absolute;left:-6px;top:16px;width:10px;height:10px;border-radius:50%;background:var(--success)}
    .tbar{height:8px;border-radius:999px;background:rgba(255,255,255,.08);overflow:hidden}
    .tbar > span{display:block;height:100%;width:0;background:var(--accent-gradient);transition:width var(--t)}
    .days{font-size:.8rem;color:var(--text-secondary)}

    /* Relax: estrelas + player */
    #stars{position:fixed;inset:0;pointer-events:none;opacity:0;transition:opacity .6s}
    #relaxPanel{display:none;margin-top:10px}
    .relax-on #stars{opacity:.9}
    .relax-on #relaxPanel{display:block}
    
    /* --- Novo Search Box --- */
    .search-wrapper { position: relative; margin-bottom: 10px; }
    .search-wrapper input { background: #161b22; border: 1px solid var(--glass-border); color: var(--text-primary); border-radius: 999px; padding: 12px 20px 12px 45px; width: 100%; font-size: 1rem; box-shadow: inset 0 2px 8px rgba(0,0,0,.4); transition: border-color .3s; }
    html.light-theme .search-wrapper input { background: #fff; }
    .search-wrapper input:focus { border-color: var(--accent-1); outline: none; box-shadow: inset 0 2px 8px rgba(0,0,0,.4), 0 0 0 3px rgba(88, 166, 255, .2); }
    .search-icon { position: absolute; top: 50%; left: 16px; transform: translateY(-50%); color: var(--text-secondary); pointer-events: none; }
    .search-wrapper .results{position:absolute;top:110%;z-index:10;left:0;right:0;background:var(--glass-bg);border:1px solid var(--glass-border);border-radius:10px;max-height:160px;overflow:auto}
    .res{padding:8px 14px;cursor:pointer}
    .res:hover{background:rgba(255,255,255,.08)}

    /* Materiais */
    .materials{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(240px,1fr))}
    .mat{display:flex;gap:12px;align-items:center;background:rgba(255,255,255,.06);padding:12px;border-radius:12px;border:1px solid var(--glass-border)}
    .mat .icon{font-size:1.4rem;background:var(--accent-gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .link{color:var(--accent-1);text-decoration:underline}

    /* Notifica√ß√µes */
    .notify{position:fixed;top:12px;left:50%;transform:translateX(-50%);display:flex;gap:8px;flex-direction:column;z-index:50}
    .note{background:rgba(0,0,0,.8);padding:10px 14px;border-radius:10px;border:1px solid var(--glass-border)}

    /* --- Infoboxes --- */
    #infobox-container { margin-bottom: 16px; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); }
    .infobox { display: flex; align-items: center; gap: 12px; background: rgba(255,255,255,.06); padding: 12px; border-radius: 12px; border: 1px solid var(--glass-border); }
    .infobox-icon { font-size: 1.5rem; color: var(--accent-1); }
    .infobox-title { font-size: .8rem; color: var(--text-secondary); margin-bottom: 2px; }
    .infobox-value { font-weight: 700; font-size: 1.1rem; }

    /* --- Mobile Nav --- */
    .mobile-nav { position: fixed; bottom: 18px; left: 50%; transform: translateX(-50%); width: calc(100% - 36px); max-width: 400px; background: rgba(22, 27, 34, .7); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid var(--glass-border); border-radius: 999px; display: flex; justify-content: space-around; padding: 8px; z-index: 99; }
    .mobile-btn { background: none; border: none; color: var(--text-secondary); padding: 8px; border-radius: 999px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; font-weight: 600; transition: all .3s ease; flex: 1; }
    .mobile-btn svg { width: 22px; height: 22px; transition: color .3s; }
    .mobile-btn.active { background: var(--accent-1); color: #010409; }
    .mobile-btn.active svg { color: #010409; }
    .mobile-btn .btn-text { display: none; }
    .mobile-btn.active .btn-text { display: inline; }
    
    /* --- Painel de Configura√ß√µes --- */
    .settings-modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,.7); backdrop-filter: blur(8px); z-index: 100; opacity: 0; pointer-events: none; transition: opacity .3s; }
    .settings-modal-backdrop.is-open { opacity: 1; pointer-events: auto; }
    .settings-modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -45%); background: #161b22; border: 1px solid var(--glass-border); border-radius: var(--radius-lg); width: 90%; max-width: 380px; padding: 24px; box-shadow: var(--card-shadow); opacity: 0; pointer-events: none; transition: opacity .3s, transform .3s; z-index: 101; /* Garante que o modal fique sobre o fundo */ }
    html.light-theme .settings-modal { background: #f0f2f5; }
    .settings-modal.is-open { opacity: 1; pointer-events: auto; transform: translate(-50%, -50%); }
    .settings-modal h2 { margin: 0 0 20px; text-align: center; }
    .setting-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--glass-border); }
    .setting-item:last-child { border-bottom: none; }
    .setting-label { display: flex; flex-direction: column; }
    .setting-label strong { color: var(--text-primary); }
    .setting-label span { font-size: .85rem; color: var(--text-secondary); }
    .switch { position: relative; display: inline-block; width: 44px; height: 24px; }
    .switch input { opacity: 0; width: 0; height: 0; }
    .slider { position: absolute; cursor: pointer; inset: 0; background-color: #333; border-radius: 34px; transition: .4s; }
    .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; border-radius: 50%; transition: .4s; }
    input:checked + .slider { background-color: var(--accent-1); }
    input:checked + .slider:before { transform: translateX(20px); }
    .settings-modal-close { position: absolute; top: 10px; right: 10px; background: none; border: none; color: var(--text-secondary); font-size: 1.5rem; cursor: pointer; }


    @media (min-width: 768px) {
      .mobile-nav { display: none; }
      .tabs { display: flex; }
      body { padding-bottom: 18px; }
    }
    @media (max-width:768px){
      .grid.auto{grid-template-columns:1fr}
      #tab-aulas .grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <canvas id="stars"></canvas>
  <div class="notify" id="notify"></div>

  <div class="app" id="app">
    <header class="header">
      <h1>DS2A Hub</h1>
      <nav class="tabs" role="tablist" aria-label="Navega√ß√£o Principal">
        <button class="tab nav-btn active" data-tab="aulas">Aulas</button>
        <button class="tab nav-btn" data-tab="trabalhos">Trabalhos</button>
        <button class="tab nav-btn" data-tab="materiais">Materiais</button>
      </nav>
      <div style="display:flex;gap:10px;align-items:center">
        <button class="settings-toggle" id="settingsBtn" title="Configura√ß√µes">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
        </button>
      </div>
    </header>

    <div class="topbar">
      <div class="progress-wrap" title="Progresso do bimestre"><div class="progress-bar" id="bimBar"></div></div>
      <span class="progress-label" id="bimLabel">0%</span>
      <span id="quote"></span>
    </div>

    <div id="infobox-container" class="grid"></div>

    <section class="announcement card" id="announce"></section>

    <main>
      <!-- AULAS -->
      <section class="card active" id="tab-aulas" role="tabpanel">
        <div class="grid" style="grid-template-columns:1.1fr .9fr;align-items:start">
          <div>
            <div class="search-wrapper">
              <span class="search-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
              </span>
              <input id="searchCal" type="text" placeholder="Buscar evento ou data..." />
              <div class="results" id="results"></div>
            </div>
            <div class="calendar" id="calendar"></div>
            <div id="dayEvents" style="margin-top:10px" class="grid"></div>
          </div>
          <div>
            <div class="lessons-controls">
              <select id="viewMode">
                <option value="hoje">Hoje</option>
                <option value="semana">Semana</option>
              </select>
              <select id="subjectFilter"><option value="">Todas as mat√©rias</option></select>
              <button class="btn" id="clearNotes">Limpar anota√ß√µes</button>
            </div>
            <div class="summary" id="lessonsSummary">‚Äî</div>
            <div class="grid auto" id="lessons"></div>
          </div>
        </div>
      </section>

      <!-- TRABALHOS -->
      <section class="card" id="tab-trabalhos" role="tabpanel">
        <h2 style="margin:0 0 10px">Timeline de prazos</h2>
        <div class="timeline" id="tlPending"></div>
        <h2 style="margin:16px 0 10px">Conclu√≠dos</h2>
        <div class="grid auto" id="tlDone"></div>
        <div id="relaxPanel" class="card">
          <h3 style="margin:0 0 8px">Modo Relax (Lofi)</h3>
          <div style="position:relative;padding-top:56.25%">
            <iframe title="Lofi" src="https://www.youtube-nocookie.com/embed/jfKfPfyJRdk?autoplay=0&controls=1" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen style="position:absolute;inset:0;width:100%;height:100%;border:0;border-radius:12px"></iframe>
          </div>
        </div>
      </section>

      <!-- MATERIAIS -->
      <section class="card" id="tab-materiais" role="tabpanel">
        <h2 style="margin:0 0 12px">Ferramentas & Recursos</h2>
        <div class="materials" id="materials"></div>
        <div class="grid" style="grid-template-columns:1fr .9fr;margin-top:14px">
          <div class="card">
            <h3 style="margin:0 0 8px">Pesquisa r√°pida</h3>
            <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px">
              <select id="engine"><option value="scholar">Google Acad√™mico</option><option value="youtube">YouTube</option></select>
              <input id="qExt" type="text" placeholder="Digite o termo..." style="flex:1" />
              <button class="btn" id="goExt">Buscar</button>
            </div>
            <div class="card">
              <h3 style="margin:0 0 8px">Link R√°pido</h3>
              <div style="display:flex;gap:8px"><input id="quick" type="text" placeholder="Cole um link √∫til..." style="flex:1" /><button id="saveQuick" class="btn">Salvar</button></div>
              <div id="quickList" style="margin-top:8px"></div>
            </div>
          </div>
          <div class="card">
            <h3 style="margin:0 0 8px">Curr√≠culo base (.txt)</h3>
            <p class="muted" style="color:var(--text-secondary);margin:0 0 8px">Baixe e edite no seu editor favorito.</p>
            <button class="btn" id="cvBtn">Baixar curr√≠culo.txt</button>
          </div>
        </div>
      </section>
    </main>
  </div>
  
  <nav class="mobile-nav">
      <button class="mobile-btn nav-btn active" data-tab="aulas" aria-label="Aulas">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>
          <span class="btn-text">Aulas</span>
      </button>
      <button class="mobile-btn nav-btn" data-tab="trabalhos" aria-label="Trabalhos">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg>
          <span class="btn-text">Trabalhos</span>
      </button>
      <button class="mobile-btn nav-btn" data-tab="materiais" aria-label="Materiais">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>
          <span class="btn-text">Materiais</span>
      </button>
  </nav>

  <div class="settings-modal-backdrop" id="settingsBackdrop"></div>
  <div class="settings-modal" id="settingsModal">
      <button class="settings-modal-close" id="settingsCloseBtn">&times;</button>
      <h2>Configura√ß√µes</h2>
      <div class="setting-item">
          <div class="setting-label">
              <strong>Modo Relax</strong>
              <span>M√∫sica ambiente e fundo estrelado</span>
          </div>
          <label class="switch">
              <input type="checkbox" id="relaxToggle">
              <span class="slider"></span>
          </label>
      </div>
      <div class="setting-item">
          <div class="setting-label">
              <strong>Tema Claro</strong>
              <span>Alternar para uma interface mais clara</span>
          </div>
          <label class="switch">
              <input type="checkbox" id="themeToggle">
              <span class="slider"></span>
          </label>
      </div>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    // ===================== 1) DADOS =====================
    const appData = {
      bimesterStartDate: '2025-08-01',
      bimesterEndDate:   '2025-09-30',
      announcement: { id:'anuncio-setembro', title:'Foco total em Setembro!', message:'Todos os trabalhos principais foram entregues! Agora √© foco total na reta final e estudos para as pr√≥ximas provas.' },
      lessons: {
        1:{ day:'Segunda-feira', subjects:[
          { name:'Geografia', color:'geografia' }, { name:'Qu√≠mica', color:'quimica' }, { name:'Ingl√™s', color:'ingles' }, { name:'F√≠sica', color:'fisica' }, { name:'Carreira', count:3, color:'carreira', room:'Lab 2' }
        ]},
        2:{ day:'Ter√ßa-feira', subjects:[
          { name:'Portugu√™s', color:'portugues' }, { name:'Hist√≥ria', color:'historia' }, { name:'Biologia', color:'biologia' }, { name:'Geografia', color:'geografia' }, { name:'Redes', count:3, color:'redes', room:'Lab 1' }
        ]},
        3:{ day:'Quarta-feira', subjects:[
          { name:'Matem√°tica', count:2, color:'matematica' }, { name:'Biologia', color:'biologia' }, { name:'Sociologia', color:'sociologia' }, { name:'Processos', count:3, color:'processos', room:'Oficina' }
        ]},
        4:{ day:'Quinta-feira', subjects:[
          { name:'Matem√°tica', color:'matematica' }, { name:'Ingl√™s', color:'ingles' }, { name:'Ed. F√≠sica', color:'edfisica' }, { name:'L√≥gica', count:2, color:'logica' }, { name:'Matem√°tica', color:'matematica' }, { name:'Portugu√™s', color:'portugues' }
        ]},
        5:{ day:'Sexta-feira', subjects:[
          { name:'Sociologia', color:'sociologia' }, { name:'L√≥gica', count:2, color:'logica' }, { name:'F√≠sica', color:'fisica' }, { name:'Portugu√™s', color:'portugues' }, { name:'Hist√≥ria', color:'historia' }, { name:'Qu√≠mica', color:'quimica' }
        ]}
      },
      assignments: [
        { title:'Educa√ß√£o F√≠sica', status:'done', date:'2025-09-04' },
        { title:'Carreira', status:'done', date:'2025-09-01' },
        { title:'Ingl√™s', status:'done',    date:'2025-08-28' },
        { title:'F√≠sica', status:'done' }
      ],
      events: {
        '2025-09-01':[ { type:'Trabalho', title:'Entrega do Trabalho de Carreira' } ],
        '2025-09-04':[ { type:'Trabalho', title:'Entrega do Trabalho de Educa√ß√£o F√≠sica' } ],
        '2025-08-28':[ { type:'Prova', title:'Prova de Matem√°tica' }, { type:'Trabalho', title:'Entrega do Trabalho de Ingl√™s' } ],
        '2025-09-07':[ { type:'Feriado', title:'Independ√™ncia do Brasil' } ],
        '2025-10-12':[ { type:'Feriado', title:'Nossa Senhora Aparecida' } ],
        '2025-11-02':[ { type:'Feriado', title:'Finados' } ],
        '2025-11-15':[ { type:'Feriado', title:'Proclama√ß√£o da Rep√∫blica' } ],
        '2025-11-20':[ { type:'Feriado', title:'Dia da Consci√™ncia Negra' } ],
        '2025-12-25':[ { type:'Feriado', title:'Natal' } ]
      },
      materials: [
        { icon:'üé®', title:'Figma', desc:'Design de interfaces e prot√≥tipos.' },
        { icon:'üíª', title:'VS Code', desc:'Editor de c√≥digo.' },
        { icon:'üì¶', title:'GitHub', desc:'Hospedagem de c√≥digo.' },
        { icon:'üß†', title:'Stack Overflow', desc:'Comunidade para d√∫vidas.' }
      ],
      quotes:[
        'A disciplina √© a ponte entre metas e realiza√ß√µes.',
        'Comece onde voc√™ est√°. Use o que voc√™ tem. Fa√ßa o que voc√™ pode.',
        'O sucesso √© a soma de pequenos esfor√ßos repetidos dia ap√≥s dia.',
        'Acredite em si mesmo e tudo ser√° poss√≠vel.',
        'O futuro pertence a quem acredita na beleza dos seus sonhos.'
      ],
      colorPalettes:[
        { accent1:'#58A6FF', accent2:'#1F6FEB' },
        { accent1:'#3FB950', accent2:'#2AAA8A' },
        { accent1:'#BF39A1', accent2:'#A371F7' },
        { accent1:'#F77825', accent2:'#D29922' }
      ]
    };

    // ===================== 2) ESTADO & ELEMENTOS =====================
    const el = {
      navBtns: document.querySelectorAll('.nav-btn'),
      panels: {
        aulas: document.getElementById('tab-aulas'),
        trabalhos: document.getElementById('tab-trabalhos'),
        materiais: document.getElementById('tab-materiais'),
      },
      stars: document.getElementById('stars'),
      settingsBtn: document.getElementById('settingsBtn'),
      settingsModal: document.getElementById('settingsModal'),
      settingsBackdrop: document.getElementById('settingsBackdrop'),
      settingsCloseBtn: document.getElementById('settingsCloseBtn'),
      relaxToggle: document.getElementById('relaxToggle'),
      themeToggle: document.getElementById('themeToggle'),
      announce: document.getElementById('announce'),
      notify: document.getElementById('notify'),
      quote: document.getElementById('quote'),
      bimBar: document.getElementById('bimBar'),
      bimLabel: document.getElementById('bimLabel'),
      infoboxContainer: document.getElementById('infobox-container'),
      // aulas
      calendar: document.getElementById('calendar'),
      searchCal: document.getElementById('searchCal'),
      results: document.getElementById('results'),
      dayEvents: document.getElementById('dayEvents'),
      lessons: document.getElementById('lessons'),
      lessonsSummary: document.getElementById('lessonsSummary'),
      viewMode: document.getElementById('viewMode'),
      subjectFilter: document.getElementById('subjectFilter'),
      clearNotes: document.getElementById('clearNotes'),
      // trabalhos
      tlPending: document.getElementById('tlPending'),
      tlDone: document.getElementById('tlDone'),
      relaxPanel: document.getElementById('relaxPanel'),
      // materiais
      materials: document.getElementById('materials'),
      engine: document.getElementById('engine'),
      qExt: document.getElementById('qExt'),
      goExt: document.getElementById('goExt'),
      quick: document.getElementById('quick'),
      saveQuick: document.getElementById('saveQuick'),
      quickList: document.getElementById('quickList'),
      cvBtn: document.getElementById('cvBtn'),
      app: document.getElementById('app')
    };

    const state = {
      today: new Date(),
      selected: new Date(),
      month: (new Date()).getMonth(),
      year: (new Date()).getFullYear(),
    };

    // ===================== 3) UTIL =====================
    const pad = (n) => n.toString().padStart(2,'0');
    const toISO = (d) => `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;

    function getWeekNumber(d){
      d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
      d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay()||7));
      const yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1));
      return Math.ceil((((d - yearStart) / 86400000) + 1)/7);
    }
    function applyWeeklyPalette(){
      const week = getWeekNumber(new Date());
      const p = appData.colorPalettes[week % appData.colorPalettes.length];
      document.documentElement.style.setProperty('--accent-1', p.accent1);
      document.documentElement.style.setProperty('--accent-2', p.accent2);
    }

    function drawStars(){
      const c = el.stars, ctx = c.getContext('2d');
      const DPR = Math.max(1, window.devicePixelRatio||1);
      c.width = innerWidth*DPR; c.height = innerHeight*DPR; c.style.width = '100%'; c.style.height='100%';
      const stars = Array.from({length:200},()=>({ x: Math.random()*c.width, y: Math.random()*c.height, r: Math.random()*1.2*DPR, s: Math.random()*0.6+0.2 }));
      let t=0; (function anim(){
        ctx.clearRect(0,0,c.width,c.height);
        for(const st of stars){
          ctx.globalAlpha = 0.5 + Math.sin((t+st.x*0.01)*st.s)*0.5;
          ctx.beginPath(); ctx.arc(st.x, st.y, st.r, 0, Math.PI*2); ctx.fillStyle = '#fff'; ctx.fill();
        }
        t+=0.02; requestAnimationFrame(anim);
      })();
    }

    function notify(msg){
      const n = document.createElement('div'); n.className='note'; n.textContent = msg; el.notify.appendChild(n);
      try {
        const ctx = new (window.AudioContext||window.webkitAudioContext)();
        const o = ctx.createOscillator(); const g = ctx.createGain();
        o.type='sine'; o.frequency.value = 880; o.connect(g); g.connect(ctx.destination);
        g.gain.setValueAtTime(0.0001, ctx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.12, ctx.currentTime+0.01);
        g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime+0.25);
        o.start(); o.stop(ctx.currentTime+0.26);
      } catch(e) {}
      setTimeout(()=>{ n.remove(); }, 2600);
    }

    // ===================== 4) CITA√á√ÉO + BIMESTRE =====================
    function renderQuote(){
      const q = appData.quotes[Math.floor(Math.random()*appData.quotes.length)];
      el.quote.textContent = '‚Äú'+q+'‚Äù';
    }
    function renderBimester(){
      const start = new Date(appData.bimesterStartDate+'T00:00:00');
      const end   = new Date(appData.bimesterEndDate+'T23:59:59');
      const now = new Date();
      const total = end - start; const done = Math.min(Math.max(now - start, 0), total);
      const pct = Math.round((done/total)*100);
      const daysRemaining = Math.max(0, Math.ceil((end - now) / (1000 * 60 * 60 * 24)));
      el.bimBar.style.width = pct+'%';
      el.bimLabel.textContent = `${pct}% (${daysRemaining} dias restantes)`;
      el.bimBar.parentElement.title = `Progresso do bimestre. Faltam ${daysRemaining} dias.`;
    }

    // ===================== 5) AVISOS E INFOBOXES =====================
    function renderAnnouncement(){
      const a = appData.announcement; const container = el.announce;
      if (!a) { container.hidden = true; return; }
      container.innerHTML = `
        <button class="close-x" id="xAnn">√ó</button>
        <h2>${a.title}</h2>
        <p style="margin:0;color:var(--text-secondary)">${a.message}</p>
        <div class="reactions" id="reax"></div>`;
      document.getElementById('xAnn').onclick = ()=> container.remove();
      const emojis = ['üëç','üî•','ü§î'];
      const r = document.getElementById('reax');
      r.innerHTML = emojis.map(e => {
        const key = `rx-${a.id}-${e}`; const on = localStorage.getItem(key)==='1';
        return `<button class="react ${on?'active':''}" data-k="${key}">${e}</button>`;
      }).join('');
      r.querySelectorAll('.react').forEach(btn=>btn.onclick = ()=>{
        const k = btn.dataset.k; const on = localStorage.getItem(k)==='1';
        if(on){ localStorage.removeItem(k); btn.classList.remove('active'); }
        else { localStorage.setItem(k,'1'); btn.classList.add('active'); particle(btn); }
      });
    }
    function particle(target){
      for(let i=0;i<14;i++){
        const p = document.createElement('span');
        const s = Math.random()*6+4; const a = Math.random()*Math.PI*2; const d = Math.random()*48+22;
        p.style.cssText = `position:absolute;left:50%;top:50%;width:${s}px;height:${s}px;border-radius:50%;background:var(--accent-1);transform:translate(-50%,-50%);opacity:.9;`;
        target.style.position='relative'; target.appendChild(p);
        p.animate([
          { transform:'translate(-50%,-50%) scale(1)', opacity:.9 },
          { transform:`translate(${x}px, ${y}px) scale(0)`, opacity:0 }
        ], { duration:600, easing:'ease-out' }).onfinish = ()=> p.remove();
      }
    }
    
    function renderInfoBoxes() {
        const todayLessons = appData.lessons[state.today.getDay()]?.subjects.length || 0;
        const pendingAssignments = appData.assignments.filter(a => a.status === 'pending' && a.date);
        const nextAssignment = pendingAssignments.sort((a,b) => new Date(a.date) - new Date(b.date))[0];
        
        let nextAssignmentText = "Nenhuma";
        if (nextAssignment) {
            const diff = Math.ceil((new Date(nextAssignment.date+'T23:59:59') - new Date())/(1000*60*60*24));
            nextAssignmentText = `${nextAssignment.title} (${diff}d)`;
        }

        const boxes = [
            { icon: 'üìö', title: 'Aulas Hoje', value: todayLessons },
            { icon: 'üéØ', title: 'Pr√≥xima Entrega', value: nextAssignmentText },
            { icon: '‚ö†Ô∏è', title: 'Pendentes', value: pendingAssignments.length }
        ];

        el.infoboxContainer.innerHTML = boxes.map(b => `
            <div class="infobox">
                <span class="infobox-icon">${b.icon}</span>
                <div>
                    <div class="infobox-title">${b.title}</div>
                    <div class="infobox-value">${b.value}</div>
                </div>
            </div>
        `).join('');
    }

    // ===================== 6) CALEND√ÅRIO =====================
    function renderCalendar(m, y){
      el.calendar.innerHTML = '';
      const first = new Date(y, m, 1); const last = new Date(y, m+1, 0);
      const days = ['Dom','Seg','Ter','Qua','Qui','Sex','S√°b'];
      const months = ['Janeiro','Fevereiro','Mar√ßo','Abril','Maio','Junho','Julho','Agosto','Setembro','Outubro','Novembro','Dezembro'];
      const head = document.createElement('div'); head.className='cal-head';
      head.innerHTML = `<button id="prev">‚Äπ</button><strong>${months[m]} ${y}</strong><button id="next">‚Ä∫</button>`;
      el.calendar.appendChild(head);
      head.querySelector('#prev').onclick = ()=>{ state.month--; if(state.month<0){state.month=11; state.year--;} renderCalendar(state.month,state.year)};
      head.querySelector('#next').onclick = ()=>{ state.month++; if(state.month>11){state.month=0; state.year++;} renderCalendar(state.month,state.year)};

      const grid = document.createElement('div'); grid.className='cal-grid';
      days.forEach(d=>{ const dv = document.createElement('div'); dv.className='cal-day'; dv.textContent=d; grid.appendChild(dv) });
      const startIdx = first.getDay(); const prevLast = new Date(y,m,0).getDate();
      for(let i=startIdx;i>0;i--){ const dv = document.createElement('div'); dv.className='cal-date'; dv.style.opacity=.35; dv.textContent = prevLast - i + 1; grid.appendChild(dv);} 
      for(let d=1; d<=last.getDate(); d++){
        const dv = document.createElement('div'); dv.className='cal-date'; dv.textContent=d;
        const thisDate = new Date(y,m,d); const iso = toISO(thisDate);
        if (d===state.today.getDate() && m===state.today.getMonth() && y===state.today.getFullYear()) dv.classList.add('today');
        if (d===state.selected.getDate() && m===state.selected.getMonth() && y===state.selected.getFullYear()) dv.classList.add('selected');
        if (appData.events[iso]){ dv.classList.add('has-events'); if(appData.events[iso].some(e=>e.type==='Feriado')) dv.classList.add('is-holiday'); }
        dv.onclick = ()=>{ state.selected = thisDate; renderCalendar(state.month,state.year); renderDay(thisDate); };
        grid.appendChild(dv);
      }
      el.calendar.appendChild(grid);
    }

    function renderDay(date){
      const iso = toISO(date); const evs = appData.events[iso]||[];
      const today = new Date(); today.setHours(0,0,0,0);
      const isPast = date < today;
      el.dayEvents.innerHTML = evs.length ? evs.map(e=>`<div class="event ${isPast ? 'is-past' : ''}"><span class="etype ${e.type}">${e.type}</span><span>${e.title}</span></div>`).join('') : '<p style="color:var(--text-secondary); text-align:center;">Nenhum evento para este dia.</p>';
      
      el.dayEvents.classList.add('reloading');
      setTimeout(() => el.dayEvents.classList.remove('reloading'), 600);

      renderLessons(date);
    }

    const nowForSearch = new Date();
    nowForSearch.setHours(0,0,0,0);
    const allEventsAndAssignments = [
      ...Object.entries(appData.events).flatMap(([date, arr]) => arr.map(x=>({ ...x, date }))),
      ...appData.assignments.filter(a=>a.date).map(a=>({ type:'Trabalho', title:`Entrega de ${a.title}`, date:a.date }))
    ];
    const searchable = allEventsAndAssignments.filter(item => {
        const itemDate = new Date(item.date + 'T00:00:00');
        return itemDate >= nowForSearch;
    });

    el.searchCal.addEventListener('input', e=>{
      const q = e.target.value.toLowerCase();
      if(q.length<2){ el.results.innerHTML=''; return; }
      const res = searchable.filter(i => i.title.toLowerCase().includes(q) || i.date.includes(q));
      el.results.innerHTML = res.map(r=>`<div class="res" data-d="${r.date}">${r.title} <small style="color:var(--text-secondary)">${new Date(r.date+'T00:00:00').toLocaleDateString()}</small></div>`).join('');
      el.results.querySelectorAll('.res').forEach(n=> n.onclick = ()=>{
        const d = new Date(n.dataset.d+'T00:00:00'); state.selected=d; state.month=d.getMonth(); state.year=d.getFullYear(); renderCalendar(state.month,state.year); renderDay(state.selected); el.searchCal.value=''; el.results.innerHTML='';
      });
    });

    // ===================== 7) AULAS (HOJE/SEMANA, FILTRO, INTERA√á√ÉO) =====================
    function initSubjectFilter(){
      const all = new Set();
      Object.values(appData.lessons).forEach(d => d.subjects.forEach(s=> all.add(s.name)));
      el.subjectFilter.innerHTML = '<option value="">Todas as mat√©rias</option>' + Array.from(all).sort().map(n=>`<option value="${n}">${n}</option>`).join('');
    }

    function renderLessons(date){
      const view = el.viewMode.value; const filter = el.subjectFilter.value;
      el.lessons.innerHTML = '';
      const days = view==='hoje' ? [date.getDay()] : [1,2,3,4,5];
      let totalAulas = 0; let alertas = [];
      const isTodayView = view === 'hoje';

      days.forEach(dow => {
        const ddata = appData.lessons[dow]; if(!ddata) return;
        const list = ddata.subjects.filter(s=>!filter || s.name===filter);
        if(!list.length) return;
        list.forEach(s=>{ if(s.count && s.count>1) alertas.push(`${s.count} aulas seguidas de ${s.name}`); totalAulas += (s.count||1); });
        if (list.length > 0 && view === 'semana') {
          const title = document.createElement('div'); 
          title.style.fontWeight='800'; 
          title.style.margin='8px 2px 4px';
          title.textContent = ddata.day; 
          el.lessons.appendChild(title);
        }
        list.forEach(subj => el.lessons.appendChild(makeLessonCard(ddata.day, subj, isTodayView ? date : null)));
      });

      if(totalAulas===0){ el.lessonsSummary.textContent = 'Sem aulas filtradas.'; return; }
      const uniqueAlerts = [...new Set(alertas)];
      el.lessonsSummary.textContent = `Total: ${totalAulas} aulas${uniqueAlerts.length? ' ‚Äî Avisos: '+uniqueAlerts.join('; ') : ''}`;
    }

    function makeLessonCard(dayName, subj, specificDate){
      const card = document.createElement('div');
      card.className = 'lesson-card';
      card.style.borderLeft = `4px solid var(--cor-${subj.color || 'default'})`;

      const key = `note-${dayName}-${subj.name}`;
      const saved = localStorage.getItem(key) || '';

      let importantMessage = '';
      if (specificDate && subj.name === 'L√≥gica' && !subj.room?.toLowerCase().includes('lab')) {
          const iso = toISO(specificDate);
          const dayEvents = appData.events[iso] || [];
          const importantEvents = dayEvents.filter(e => e.type === 'Prova' || e.type === 'Trabalho');
          if (importantEvents.length > 0) {
              importantMessage = `<div class="important-note"><strong>Aten√ß√£o:</strong> ${importantEvents.map(e => e.title).join(', ')} hoje!</div>`;
          }
      }

      card.innerHTML = `
        <div class="lesson-header">
            <strong>${subj.name} ${(subj.count && subj.count > 1) ? `<span class='badge'>${subj.count}x</span>` : ''}</strong>
            ${subj.room ? `<div class="badge">Sala: ${subj.room}</div>` : ''}
        </div>
        <small class="notes-prompt">Clique para ver/editar anota√ß√µes</small>
        <div class="lesson-notes">
            ${importantMessage}
            <textarea rows="4" placeholder="Anota√ß√µes r√°pidas (salvas neste navegador)">${saved}</textarea>
            <button class="btn save-note">Salvar & Fechar</button>
        </div>`;
      
      card.addEventListener('click', () => {
          if (!card.classList.contains('is-open')) {
             card.classList.add('is-open');
          }
      });
      
      const saveBtn = card.querySelector('.save-note');
      const ta = card.querySelector('textarea');
      
      saveBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          localStorage.setItem(key, ta.value);
          notify('Anota√ß√µes salvas');
          card.classList.remove('is-open');
      });

      return card;
    }

    el.viewMode.onchange = ()=> renderLessons(state.selected);
    el.subjectFilter.onchange = ()=> renderLessons(state.selected);
    el.clearNotes.onclick = ()=>{
      if(!confirm('Limpar todas as anota√ß√µes vis√≠veis?')) return;
      const filter = el.subjectFilter.value; const view = el.viewMode.value; const days = view==='hoje' ? [state.selected.getDay()] : [1,2,3,4,5];
      days.forEach(dow=>{ const ddata = appData.lessons[dow]; if(!ddata) return; ddata.subjects.forEach(s=>{ if(!filter || filter===s.name){ localStorage.removeItem(`note-${ddata.day}-${s.name}`); }}); });
      notify('Anota√ß√µes limpas'); renderLessons(state.selected);
    };

    // ===================== 8) TRABALHOS (TIMELINE + PROGRESSO) =====================
    function renderAssignments(){
      el.tlPending.innerHTML=''; el.tlDone.innerHTML='';
      const now = new Date();
      const start = new Date(appData.bimesterStartDate+'T00:00:00');
      appData.assignments.forEach(a => {
        if(a.status==='done'){
          const c = document.createElement('div'); c.className='t-item done'; c.innerHTML = `<strong>${a.title}</strong><div class="days">Conclu√≠do ${a.date?('em '+new Date(a.date+'T00:00:00').toLocaleDateString()):''}</div>`; el.tlDone.appendChild(c);
          return;
        }
        const wrap = document.createElement('div'); wrap.className='t-item pending';
        let pct = 0, daysLeft = '‚Äî';
        if(a.date){
          const due = new Date(a.date+'T23:59:59');
          const total = Math.max(due - start, 1);
          const elapsed = Math.min(Math.max(now - start, 0), total);
          pct = Math.round((elapsed/total)*100);
          const diff = Math.ceil((due - now)/(1000*60*60*24));
          daysLeft = diff>=0? `${diff} dia(s) restantes` : `Atrasado`;
          if (now > due) wrap.classList.add('is-past');
          if(diff===1) notify(`‚ö†Ô∏è ${a.title} vence amanh√£!`);
          if(diff===0) notify(`‚è∞ ${a.title} vence hoje!`);
        }
        wrap.innerHTML = `<strong>${a.title}</strong><div class="days">${a.date?('Prazo: '+new Date(a.date+'T00:00:00').toLocaleDateString()+' ‚Äî '):''}${daysLeft}</div><div class="tbar"><span style="width:${pct}%"></span></div>`;
        el.tlPending.appendChild(wrap);
      });
    }

    // ===================== 9) MATERIAIS + BUSCAS + QUICK LINK + CV =====================
    function renderMaterials(){
      el.materials.innerHTML = appData.materials.map(m=>`<div class="mat"><span class="icon">${m.icon}</span><div><div style="font-weight:700">${m.title}</div><div style="color:var(--text-secondary)">${m.desc}</div></div></div>`).join('');
      const saved = JSON.parse(localStorage.getItem('quick-links')||'[]');
      el.quickList.innerHTML = saved.length ? saved.map(u=>`<div>üöÄ <a class="link" href="${u}" target="_blank" rel="noopener noreferrer">${u}</a></div>`).join('') : '<span style="color:var(--text-secondary)">Nenhum link salvo ainda.</span>';
    }
    el.goExt.onclick = ()=>{
      const q = encodeURIComponent(el.qExt.value.trim()); if(!q) return;
      const base = el.engine.value==='scholar' ? 'https://scholar.google.com/scholar?q=' : 'https://www.youtube.com/results?search_query=';
      window.open(base+q, '_blank','noopener');
    };
    el.saveQuick.onclick = ()=>{
      const v = el.quick.value.trim(); if(!v) return; const arr = JSON.parse(localStorage.getItem('quick-links')||'[]');
      arr.unshift(v); localStorage.setItem('quick-links', JSON.stringify(arr.slice(0,8))); el.quick.value=''; renderMaterials(); notify('Link salvo');
    };
    el.cvBtn.onclick = ()=>{
      const txt = `NOME COMPLETO\nCidade ‚Äì UF | (00) 00000-0000 | email@exemplo.com\nLinkedIn/GitHub: https://...\n\nOBJETIVO\nEst√°gio/Junior em Desenvolvimento.\n\nFORMA√á√ÉO\n‚Ä¢ Curso T√©cnico/Ensino M√©dio ‚Äì Escola X (2024‚Äì2026)\n\nHABILIDADES\n‚Ä¢ HTML, CSS, JS | Git/GitHub | Figma | Trabalho em equipe\n\nPROJETOS\n‚Ä¢ DS2A Hub ‚Äì hub de estudos com calend√°rio, tarefas e materiais.\n\nATIVIDADES/EXTRAS\n‚Ä¢ Monitoria, eventos, voluntariado.\n`;
      const blob = new Blob([txt], {type:'text/plain'}); const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download='curriculo.txt'; a.click(); URL.revokeObjectURL(url);
    };

    // ===================== 10) TABS E CONFIGURA√á√ïES =====================
    el.navBtns.forEach(btn => btn.addEventListener('click', () => {
        const tabName = btn.dataset.tab;
        el.navBtns.forEach(b => b.classList.toggle('active', b.dataset.tab === tabName));
        Object.values(el.panels).forEach(p => p.classList.remove('active'));
        el.panels[tabName]?.classList.add('active');
    }));

    function setupSettings() {
        const openSettings = () => {
            el.settingsModal.classList.add('is-open');
            el.settingsBackdrop.classList.add('is-open');
        };
        const closeSettings = () => {
            el.settingsModal.classList.remove('is-open');
            el.settingsBackdrop.classList.remove('is-open');
        };
        el.settingsBtn.onclick = openSettings;
        el.settingsCloseBtn.onclick = closeSettings;
        el.settingsBackdrop.onclick = closeSettings;

        // Relax Mode
        const isRelax = localStorage.getItem('relaxMode') === 'true';
        document.body.classList.toggle('relax-on', isRelax);
        el.relaxToggle.checked = isRelax;
        el.relaxToggle.onchange = (e) => {
            const active = e.target.checked;
            document.body.classList.toggle('relax-on', active);
            localStorage.setItem('relaxMode', active);
            notify(`Modo Relax ${active ? 'ativado' : 'desativado'}`);
        };

        // Theme
        const isLight = localStorage.getItem('theme') === 'light';
        document.documentElement.classList.toggle('light-theme', isLight);
        el.themeToggle.checked = isLight;
        el.themeToggle.onchange = (e) => {
            const active = e.target.checked;
            document.documentElement.classList.toggle('light-theme', active);
            localStorage.setItem('theme', active ? 'light' : 'dark');
            notify(`Tema ${active ? 'claro' : 'escuro'} aplicado`);
        };
    }

    // ===================== 11) INIT =====================
    applyWeeklyPalette();
    renderQuote();
    renderBimester();
    renderAnnouncement();
    renderInfoBoxes();
    renderCalendar(state.month, state.year);
    renderDay(state.selected);
    initSubjectFilter();
    renderAssignments();
    renderMaterials();
    drawStars();
    setupSettings();

    (function deadlineAlerts(){
      const now = new Date(); appData.assignments.filter(a=>a.status==='pending' && a.date).forEach(a=>{
        const diff = Math.ceil((new Date(a.date+'T23:59:59')-now)/(1000*60*60*24));
        if(diff>=0 && diff<=2) notify(`‚ö†Ô∏è ${a.title} vence em ${diff} dia(s)`);
      });
    })();

    setInterval(renderBimester, 60*60*1000);
    window.addEventListener('resize', drawStars);
  });
  </script>
</body>
</html>

